# [미션 - 블랙잭] 명세서

## 프로그램 구성 요소
1. 사용자
   1. 딜러 (컴퓨터)
      1. 가지고 있는 카드
   2. 플레이어 (1명 이상)
      1. 가지고 있는 카드
      2. 이름: 입력값
      3. 베팅 금액: 입력값
2. 카드 한 장
   1. 심볼 (ACE, TWO, THREE, ..., KING)
   2. 타입 (SPADE, DIAMOND, HEART, CLUB)
3. 게임 규칙 상수
   1. 블랙잭 : 21
   2. 딜러 제외 최소, 최대 인원 : 1 ~ 7 
   3. 최소, 최대 베팅 금액 : 5_000 ~ 10_000_000
4. 카드 지급기
   1. 트럼프 카드 전체 (총 13*4 = 52장)
5. 카드 숫자 계산기
6. 수익 계산기

## 게임 진행 순서
1. 게임 시작
   1. 게임에 참여하는 플레이어 이름을 모두 입력받는다.
   2. 플레이어의 베팅 금액을 순서대로 입력받는다.
   3. 딜러와 플레이어에게 한 사람 당 2장의 카드를 지급한다. 
   4. 각 사용자가 받은 카드를 딜러, 등록한 플레이어 순서대로 카드를 오픈(출력)한다. 이 때 딜러의 카드는 한 장만 오픈한다.
   
2. 히트 / 스탠드
   - 1~4번 까지의 과정을 모든 플레이어가 완료할 때까지 반복한다.
   1. 플레이어가 "n"(아니오)을 선택할 때까지 한 장의 카드를 더 받을지 물어본다.
   2. "y"(예)를 선택했을 경우 카드를 새로 추가하고, 사용자가 현재 가지고 있는 모든 카드를 출력한다.
   3. 처음부터 "n"(아니오)를 선택했을 경우, 사용자가 현재 가지고 있는 모든 카드를 출력한다.
   4. 카드를 추가해 합이 21을 초과했을 경우(버스트) 딜러가 사용자의 베팅 금액을 가져가고 다음 플레이어의 차례로 넘어간다.
   5. 딜러는 카드의 합을 계산하여 숫자가 이하인 경우에만 한 장의 카드를 추가한다. (17 이상이면 더 이상 추가하지 않는다.)

3. 결산
   1. 모든 사용자가 `히트/스탠드`를 마치면 각 사용자의 카드 합을 계산해 결과를 오픈한다.
   2. 아래의 경우 중 해당되는 경우를 찾아 수익을 계산한다.
      - 딜러의 카드 합과 플레이어의 카드 합을 비교해, 21 또는 21에 더 가까운 숫자를 가진 플레이어는 승리한다.
      1. 딜러의 숫자가 21을 초과한 경우(버스트) 그 시점에 버스트되지 않은 플레이어는 가지고 있는 패와 상관 없이 모두 승리 처리한다.
         - 모든 플레이어 수익: 베팅 금액
         - 딜러 수익: (-베팅 금액)*(플레이어 수)
      2. 딜러와 플레이어가 동시에 21인 경우 플레이어는 베팅한 금액을 돌려받는다.
         - 플레이어 수익: 0원
         - 딜러 수익: 0원
      3. 플레이어가 승리한 경우, 플레이어의 처음 두 장의 카드 합이 21이면 베팅 금액의 1.5배를 딜러에게 받는다.
         - 플레이어 수익: 베팅 금액*(1.5)
         - 딜러 수익: -베팅금액*(1.5)
      4. 플레이어가 승리한 경우, 3번 외의 경우에는 베팅 금액의 1배를 딜러에게 받는다.
         - 플레이어 수익: 베팅 금액
         - 딜러 수익: -베팅 금액
   3. 사용자 별 최종 수익을 출력한다.

## 기능 목록
### 도메인 로직
1. 
   - [x] 게임에 참여할 사용자를 모두 등록하는 기능
     - [x] 플레이어 객체를 새로 생성하여 이름, 베팅 금액을 저장한다.
     - [x] 정보를 저장한 플레이어 객체를 사용자 목록에 저장한다.
       - [x] `예외` 참여 인원이 유효하지 않을 경우 예외 발생
       - [x] `예외` 플레이어의 베팅 금액이 유효하지 않을 경우 예외 발생
2.
     - [x] 셔플된 트럼프 카드를 관리하는 덱(Deck)을 세팅하고 사용하는 기능
       - [x] 덱에서는 가장 위에 있는 카드 한 장을 꺼낼 수 있다.
           - [x] `예외` 트럼프 카드의 모든 카드를 소진했을 경우 예외 발생
3.
    - [ ] 사용자에게 카드를 지급하는 기능
      - [ ] 사용자의 정보에 덱에서 꺼낸 카드를 저장한다.
4. 
   - [ ] 사용자가 현재 가지고 있는 카드의 합을 계산하는 기능
     - [ ] A 카드를 가지고 있는 경우, 21을 넘지 않거나 21에 더 가까운 합으로 숫자를 선택하여 계산한다.
5. 
   - [ ] 사용자의 버스트 여부를 확인하는 기능
     - [ ] 현재 가지고 있는 카드의 합이 21을 넘는지 확인한다.
6. 
   - [ ] 플레이어의 카드 추가 여부를 확인하는 기능
     - [ ] 플레이어로부터 전달받은 키워드에 따라 카드를 지급하거나, 지급하지 않는다.
7. 
   - [ ] 딜러의 카드 추가 여부를 확인하는 기능
     - [ ] 딜러가 가지고 있는 카드의 합이 16 이하이면 추가하도록 하고, 17 이상이면 추가하지 않도록 한다.
     - [ ] 추가 여부가 거짓이 될 때까지 카드 추가를 반복한다.
8. 
   - [ ] 가지고 있는 카드를 오픈하는 기능 (출력을 위한 값 전달)
      - [ ] 등록한 사용자 순서대로 정보를 제공한다.
      - [ ] 게임 시작 시 오픈할 때에는, 딜러의 카드 중 첫번째 카드의 정보만 제공한다.
      - [ ] 결산 시 오픈할 때에는, 각 사용자 별 카드 합 결과를 함께 제공한다.
9. 
   - [ ] 한 플레이어와 그에 대한 딜러의 수익을 계산하는 기능
     - [ ] 딜러와 플레이어의 카드 합을 비교한다.
     - [ ] 비교한 결과에 따라 해당 플레이어의 수익, 딜러의 수익을 업데이트한다.
10. 
    - [ ] 한 사용자의 수익을 더하거나 빼는 기능
      - [ ] 수익은 마이너스 값이 될 수 있다.
### UI 로직
1.
    - [ ] 게임에 참여할 사용자의 이름을 입력받는 기능
      - [ ] 정해진 구분자(`,`)를 기준으로 분리한다.
      - [ ] 시작과 끝의 공백은 삭제해서 동일한 이름으로 취급한다. (`pobi`, ` pobi`)
      - [ ] `예외` 정해진 형식과 일치하지 않을 경우 예외 발생, 입력 오류 메시지를 출력하고 다시 입력받는다.
      - [ ] `예외` 동일한 이름이 2명 이상 존재할 경우 예외 발생, 입력 오류 메시지를 출력하고 다시 입력받는다.
      - [ ] `예외` 범위 밖 인원 수일 경우 예외 발생, 입력 오류 메시지를 출력하고 다시 입력받는다.
2.
    - [ ] 각 플레이어의 베팅 금액을 입력받는 기능
      - [ ] `예외` 숫자가 아닌 경우 예외 발생, 입력 오류 메시지를 출력하고 다시 입력받는다.
      - [ ] `예외` 범위 외 수일 경우 예외 발생, 입력 오류 메시지를 출력하고 다시 입력받는다.
3.
    - [ ] 게임 진행 안내 메시지를 출력하는 기능
      - [ ] `딜러와, (모든 사용자명)에게 2장의 카드를 나누었습니다.`
      - [ ] (게임 시작 시) 사용자 별 카드 출력
      - [ ] (게사용자 별 카드 및 합산 결과 출력
      - [ ] `예외` 출력할 값이 null이면 예외 발생
4.
    - [ ] 최종 수익을 출력하는 기능
        - [ ] 정해진 형식에 맞춰 사용자 이름과 수익을 출력한다.
        - [ ] `예외` 출력할 값이 null이면 예외 발생
5. - [ ] 사용자 입력 외 오류가 났을 때 이를 사용자에게 알리는 기능
    - [ ] 사용자 입력 외 범위에서 예외 발생 시 전달받은 에러 메시지를 출력한다. (그 후 컨트롤러에서 프로그램 종료)

## 클래스 설계
### Domain
- card
  - Card
  - CardFactory
  - Symbol
  - Type
  - Deck* : 셔플된 트럼프 카드 한 세트를 덱으로 관리하는 클래스
- user
  - Dealer
  - Player
- rule
  - GameRule

### Model
- BlackjackGame
  - 딜러, 플레이어, 트럼프 카드를 관리하는 클래스
- CardPointCalculator
  - 카드 합을 계산하는 기능을 제공하는 클래스
- EarningCalculator
  - 한 플레이어 - 딜러 간의 수익 결과를 계산하는 클래스

### View
- OutputView
  - 사용자 상호작용 중 출력을 담당하는 클래스
- InputVIew
  - 사용자 상호작용 중 입력을 담당하는 클래스

### Controller
- GameController
  - 전체 게임 흐름 및 Model-View 상호작용을 관리하는 클래스


## 단위 테스트 목록
- [x] Domain-1 : 게임 참여 사용자 등록
  - [x] 참여 인원이 유효하지 않을 경우 예외 발생
  - [x] 플레이어의 베팅 금액이 유효하지 않을 경우 예외 발생
- [x] Domain-2 : 카드 덱 세팅 및 사용
  - [x] 카드 덱 세팅: 기본 트럼프 카드 세트로부터 한 장이라도 셔플되었는지 확인
  - [x] 카드 덱 사용: 카드를 꺼낼 때, 덱이 비었을 경우 예외 발생
- [ ] Domain-3 : 사용자 카드 지급